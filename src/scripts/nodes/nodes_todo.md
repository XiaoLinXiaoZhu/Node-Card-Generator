# 卡片文本格式化系统设计文档

## 1. 功能需求分析

### 1.1 文本格式化需求
1. 标题格式化
   - 匹配模式：以冒号结尾的文本
   - 样式：深蓝色、粗体
   - 示例：`祷昭弗光叶:` → 标题样式

2. 技能类型图标
   - 匹配模式：`[锁定技]`、`[主动技]`等
   - 替换为对应图标
   - 不显示原始文本
   - 示例：`[锁定技]` → 锁定技图标

3. 强调文本
   - 匹配模式：特定关键词（如"一回合一次"）
   - 样式：深蓝色背景、白色文本、圆角
   - 示例：`一回合一次` → 强调样式

4. 特殊文本
   - 匹配模式：特定关键词（如"抽一张牌"）
   - 样式：加粗、带图标
   - 示例：`抽一张牌` → 特殊样式

### 1.2 用户友好性需求
1. 无需代码知识
   - 不要求用户编写HTML
   - 不要求用户编写CSS
   - 不要求用户理解正则表达式

2. 可视化配置
   - 提供图形界面配置规则
   - 实时预览效果
   - 拖拽式操作

3. 预设模板
   - 提供常用规则模板
   - 支持保存自定义规则
   - 支持导入导出规则

## 2. 节点系统设计

### 2.1 核心节点：TextFormatter
- 功能：文本格式化的核心节点
- 输入：
  - 原始文本（string）
  - 样式配置（object，可选）
- 输出：
  - 格式化后的HTML（string）
  - 样式对象（object）

### 2.2 辅助节点

#### 2.2.1 RuleConfigurator
- 功能：规则配置节点
- 输入：
  - 规则模板（object，可选）
- 输出：
  - 规则配置（object）
- 特点：
  - 可视化规则编辑器
  - 支持拖拽排序
  - 实时预览

#### 2.2.2 StylePreset
- 功能：样式预设节点
- 输入：
  - 预设名称（string，可选）
- 输出：
  - 样式配置（object）
- 特点：
  - 内置常用样式
  - 支持自定义保存
  - 支持导入导出

#### 2.2.3 IconSelector
- 功能：图标选择节点
- 输入：
  - 图标类型（string，可选）
- 输出：
  - 图标URL（string）
- 特点：
  - 内置图标库
  - 支持自定义上传
  - 预览功能

## 3. 规则配置界面设计

### 3.1 规则编辑器
1. 规则类型选择
   - 下拉菜单选择（标题/技能/强调/特殊）
   - 每种类型对应不同配置项

2. 匹配模式配置
   - 关键词输入
   - 模式选择（精确匹配/包含/正则）
   - 示例文本

3. 样式配置
   - 颜色选择器
   - 字体选择
   - 大小调整
   - 图标选择

### 3.2 预览区域
1. 实时预览
   - 显示格式化效果
   - 支持缩放
   - 支持暗色/亮色主题

2. 调试信息
   - 显示匹配结果
   - 显示应用规则
   - 错误提示

## 4. 实现步骤

### 4.1 第一阶段：基础功能
1. 实现 TextFormatter 节点
2. 实现基本规则配置
3. 实现样式转换

### 4.2 第二阶段：用户界面
1. 实现规则编辑器
2. 实现预览功能
3. 实现预设管理

### 4.3 第三阶段：扩展功能
1. 实现图标管理
2. 实现规则导入导出
3. 实现自定义样式

## 5. 注意事项

### 5.1 性能考虑
1. 规则缓存
2. 样式优化
3. 渲染性能

### 5.2 用户体验
1. 操作简单直观
2. 即时反馈
3. 错误提示友好

### 5.3 可扩展性
1. 支持自定义规则
2. 支持自定义样式
3. 支持插件系统

## 6. 后续优化方向

### 6.1 功能扩展
1. 支持更多文本格式
2. 支持动画效果
3. 支持响应式布局

### 6.2 工具集成
1. 与图片编辑器集成
2. 与布局系统集成
3. 与导出系统集成

### 6.3 用户体验
1. 添加操作引导
2. 优化配置流程
3. 提供更多预设